(function(e){function t(t){for(var o,a,r=t[0],c=t[1],l=t[2],d=0,h=[];d<r.length;d++)a=r[d],Object.prototype.hasOwnProperty.call(n,a)&&n[a]&&h.push(n[a][0]),n[a]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);u&&u(t);while(h.length)h.shift()();return i.push.apply(i,l||[]),s()}function s(){for(var e,t=0;t<i.length;t++){for(var s=i[t],o=!0,r=1;r<s.length;r++){var c=s[r];0!==n[c]&&(o=!1)}o&&(i.splice(t--,1),e=a(a.s=s[0]))}return e}var o={},n={app:0},i=[];function a(t){if(o[t])return o[t].exports;var s=o[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=e,a.c=o,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(s,o,function(t){return e[t]}.bind(null,o));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=t,r=r.slice();for(var l=0;l<r.length;l++)t(r[l]);var u=c;i.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"0d65":function(e,t,s){},"452c":function(e,t,s){},5237:function(e,t,s){e.exports=s.p+"img/correct.572c7489.svg"},"56d7":function(e,t,s){"use strict";s.r(t);s("be4f"),s("450d");var o=s("896a"),n=s.n(o),i=(s("e260"),s("e6cf"),s("cca6"),s("a79d"),s("2b0e")),a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"app"}},[e.isLongTap?o("div",{attrs:{id:"tipTop"}},[o("div",{staticClass:"left"},[e._v("全部消息")]),o("button",{staticClass:"right",on:{click:function(t){e.isLongTap=!1}}},[e._v("取消")])]):e._e(),o("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"msgHolder",class:[e.isLongTap?"shortened":"normal"],attrs:{id:"msgHolder"},on:{scroll:e.reachBottom}},e._l(e.messages,(function(t){return o("div",{key:t.id,staticClass:"item",on:{touchstart:e.userTouchStart,touchend:e.userTouchEnd}},[o("div",{staticClass:"header"},[o("div",{staticClass:"holder",style:{paddingRight:t.is_read?"0":"40px"}},[o("div",{class:["title",t.showDetail?"":"ellipsis-one"]},[e._v(" "+e._s(t.title)+" ")]),e.isQnhdMsg&&!t.is_read?o("div",{staticClass:"unread"},[e._v("未读")]):e._e()]),e.isQnhdMsg&&!e.isLongTap?o("div",{staticClass:"more-holder"},[o("button",{staticClass:"more",on:{click:function(s){return e.handleClickMore(t)}}},[o("img",{staticClass:"icon",attrs:{src:s("f51c"),alt:"..."}})]),o("div",{directives:[{name:"show",rawName:"v-show",value:t.showTip,expression:"msg.showTip"}],attrs:{id:"tip"},on:{click:function(s){return e.deleteMsg([t.id])}}},[o("div",{staticClass:"delete"},[e._v("删除")])])]):e.isQnhdMsg?o("div",{staticClass:"more-holder"},[o("button",{staticClass:"batch",style:{backgroundColor:t.is_chosen?"#363c54":"#f7f7f8"},on:{click:function(e){t.is_chosen=!t.is_chosen}}},[o("img",{directives:[{name:"show",rawName:"v-show",value:t.is_chosen,expression:"msg.is_chosen"}],staticClass:"icon",attrs:{src:s("5237"),alt:"√"}})])]):e._e()]),o("div",{staticClass:"timestamp"},[e._v(e._s(e.timeFromNow(t.created_at)))]),o("div",{staticClass:"content-holder"},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.showDetail,expression:"msg.showDetail"}],staticClass:"content",style:{flex:t.showDetail?"1":"0"}},[o("mavon-editor",{attrs:{toolbarsFlag:!1,subfield:!1,defaultOpen:"preview",boxShadow:!1,previewBackground:"#ffffff"},model:{value:t.content,callback:function(s){e.$set(t,"content",s)},expression:"msg.content"}})],1),o("div",{directives:[{name:"show",rawName:"v-show",value:!t.showDetail,expression:"!msg.showDetail"}],staticClass:"content modify"},[o("div",{staticClass:"ellipsis-two",domProps:{innerHTML:e._s(t.cut)}})]),t.showDetail?e._e():o("div",{staticStyle:{flex:"1"}}),o("div",{staticClass:"additional"},[o("div",{staticClass:"sender",style:{fontWeight:e.isQnhdMsg?"400":"bold",color:e.isQnhdMsg?"#6c6c6c":"black"}},[e.isQnhdMsg?o("div",[e._v("来自")]):o("img",{attrs:{src:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fblog.tsyzz.com%2Fupload%2F2016%2F0525%2F0156061529.png&refer=http%3A%2F%2Fblog.tsyzz.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1645766520&t=f5b635f791a4727dfadad840d5cc2875",alt:"logo"}}),o("div",{staticStyle:{"margin-left":"5px"}},[e._v(e._s(t.sender))])]),o("button",{staticClass:"detail",on:{click:function(s){return e.handleUnfold(t)}}},[o("img",{class:["icon",t.showDetail?"":"rotate"],attrs:{src:s("a101"),alt:">>"}}),e._v(" "+e._s(t.showDetail?"收起":"展开")+" ")])])])])})),0),e.isLongTap?o("div",{attrs:{id:"tipBottom"}},[o("div",{staticClass:"left"},[o("button",{staticClass:"batch",style:{backgroundColor:e.is_all_chosen?"#363c54":"#f7f7f8"},on:{click:e.handleChooseAll}},[o("img",{directives:[{name:"show",rawName:"v-show",value:e.is_all_chosen,expression:"is_all_chosen"}],staticClass:"icon",attrs:{src:s("5237"),alt:"√"}})]),e._v(" 全选 ")]),o("button",{staticClass:"right",on:{click:e.handleDeletes}},[e._v("删除")])]):e._e(),o("router-view"),e.showNoMsgTip?o("div",{attrs:{id:"noData"}},[e._v(" "+e._s(e.isQnhdMsg?"暂无湖底通知":"暂无部门公告")+" ")]):e._e(),e.globalTip?o("div",{attrs:{id:"globalTip"}},[e._v(e._s(e.globalTip))]):e._e()],1)},r=[],c=s("2909"),l=(s("d3b7"),s("159b"),s("99af"),s("ac1f"),s("466d"),s("e9c4"),s("fb6a"),s("5319"),s("7c5c")),u=new l["marked"].Renderer;l["marked"].setOptions({renderer:u,gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1});var d={data:function(){return{messages:[],msgTemp:{id:0,created_at:"2022-04-17T20:04:20.921747+08:00",sender:"湖底管理员",title:"您的帖子因违反社区规范已被处理，请您",content:"### Compiles and hot-reloads for development\n```\nnpm run serve\n```\n### Compiles and minifies for production\n```\nnpm run build\n```\n### Lints and fixes files\n```\nnpm run lint\n```\n### Customize configuration\nSee [Configuration Reference](https://cli.vuejs.org/config/).<img src='https://t7.baidu.com/it/u=2291349828,4144427007&fm=193&f=GIF' />",is_read:!1},pageForMsgs:1,total:0,timeOutEvent:0,isLongTap:!1,is_all_chosen:!1,globalTip:"",showNoMsgTip:!1,loading:!1}},mounted:function(){this.$store.commit("setType",this.$route.query.type),this.getMessages()},computed:{getUrlToken:function(){return this.$route.query.token},isQnhdMsg:function(){return"default"===this.$store.state.type}},methods:{getMessages:function(){var e=this,t=this.isQnhdMsg?"/message/notices":"message/notices/department";this.$request.get(t,{page:this.pageForMsgs,page_size:10}).then((function(t){if(console.log(t),200===t.code){if(t.data.list.length){var s=[];t.data.list.forEach((function(t){s.push({id:t.id,title:t.title,sender:t.sender,content:t.content,cut:e.contentPreview(t.content),symbol:t.symbol,created_at:t.created_at,is_read:!e.isQnhdMsg||t.is_read,showTip:!1,showDetail:!1,is_chosen:!1})})),e.messages=[].concat(Object(c["a"])(e.messages),s)}e.total=t.data.total,0==e.messages&&(e.showNoMsgTip=!0),e.loading=!1}else 20001===t.code&&(e.loading=!1,e.refreshToken())}))},reachBottom:function(){var e=this,t=this.$refs.msgHolder;t.scrollTop===t.scrollHeight-t.offsetHeight&&(console.log("到底部了"),this.messages.length==10*this.pageForMsgs?(this.pageForMsgs++,this.getMessages()):(this.globalTip="No More Data",setTimeout((function(){e.globalTip=""}),1e3)))},msgNewSearch:function(){this.loading=!0,this.messages=[],this.pageForMsgs=1,this.getMessages()},handleClickMore:function(e){if(e.showTip)e.showTip=!1;else{for(var t=0;t<this.total;t++)if(this.messages[t].showTip){this.messages[t].showTip=!1;break}e.showTip=!0}},handleChooseAll:function(){this.is_all_chosen?this.messages.forEach((function(e){e.is_chosen=!1})):this.messages.forEach((function(e){e.is_chosen=!0})),this.is_all_chosen=!this.is_all_chosen},deleteMsg:function(e){var t=this;this.$request.get("/message/notices/delete".concat(this.arrToStr(e)),{}).then((function(e){200===e.code&&setTimeout((function(){t.msgNewSearch()}),500)}))},handleDeletes:function(){for(var e=this,t=[],s=0;s<this.messages.length;s++)this.messages[s].is_chosen&&t.push(this.messages[s].id);if(!t.length)return this.globalTip="删除内容为空",void setTimeout((function(){e.globalTip=""}),1e3);this.$request.get("/message/notices/delete".concat(this.arrToStr(t)),{}).then((function(t){200===t.code&&setTimeout((function(){e.isLongTap=!1,e.msgNewSearch()}),500)}))},arrToStr:function(e){for(var t="?",s=0;s<e.length;s++)t+="ids="+e[s]+"&";return t},handleUnfold:function(e){if(e.showDetail=!e.showDetail,this.isQnhdMsg&&!e.is_read){var t=new FormData;t.append("id",e.id);var s={headers:{"Content-Type":"multipart/form-data"}};this.$request.post("/message/notice/read",t,s).then((function(t){200===t.code&&(e.is_read=!0)}))}},userTouchStart:function(){var e=this;if(this.isQnhdMsg)return this.timeOutEvent=setTimeout((function(){e.timeOutEvent=0,e.is_all_chosen=!1,e.isLongTap=!0,console.log("长按事件触发")}),500),!1},userTouchEnd:function(){if(this.isQnhdMsg)return clearTimeout(this.timeOutEvent),0!==this.timeOutEvent&&console.log("你这是点击，不是长按"),!1},contentPreview:function(e){var t=/<p>(.*?)<\/p>/g,s=/<img(.*?)>/g,o=/alt=\\"(.*?)\\">/g,n=/<a(.*?)<\/a>/g,i=/>(.*?)</g,a=/\\n/g,r=Object(l["marked"])(e),c=JSON.stringify(r).match(t),u="";if(null==c)u="展开查看详情...";else for(var d=0;d<c.length;d++){var h=c[d].match(s),g=c[d].match(n);if(console.log(h,g),null!=h)for(var f=0;f<h.length;f++){var p="[图片] "+h[f].match(o)[0].slice(6,-3);c[d]=c[d].replace(h[f],p)}if(null!=g)for(var m=0;m<g.length;m++){var v="[链接] "+g[m].match(i)[0].slice(1,-1);c[d]=c[d].replace(g[m],v)}c[d]=c[d].replace(a,"<br/>"),u+=c[d]}return u},returnCompleteTime:function(e){return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+("".concat(e.getDate()<10?"0":"")+e.getDate())+" "+("".concat(e.getHours()<10?"0":"")+e.getHours())+":"+("".concat(e.getMinutes()<10?"0":"")+e.getMinutes())+":"+("".concat(e.getSeconds()<10?"0":"")+e.getSeconds())},timeFromNow:function(e){var t=new Date,s=new Date(e),o=t.getTime()-s.getTime(),n=Math.floor(o/864e5),i=o%864e5,a=Math.floor(i/36e5),r=i%36e5,c=Math.floor(r/6e4),l=r%6e4,u=Math.round(l/1e3);return n>0?this.returnCompleteTime(s):a>0?"".concat(a,"小时").concat(c,"分钟前"):c>0?"".concat(c,"分钟前"):"".concat(u,"秒前")},refreshToken:function(){var e=this;this.$request.get("/auth/".concat(this.getUrlToken),{}).then((function(t){200===t.code&&(e.$store.commit("setToken",t.data.token),setTimeout((function(){e.msgNewSearch()}),100))}))}}},h=d,g=(s("87cf"),s("b0a0"),s("2877")),f=Object(g["a"])(h,a,r,!1,null,"1edab872",null),p=f.exports,m=s("8c4f");i["default"].use(m["a"]);var v=[],b=new m["a"]({mode:"hash",routes:v}),_=b,w=s("2f62");i["default"].use(w["a"]);var T,y=new w["a"].Store({state:{token:"",type:"default"},mutations:{setToken:function(e,t){e.token=t},setType:function(e,t){e.type=t,console.log(e.type)}},actions:{},modules:{}}),M=s("5530"),C=s("bc3a"),k=s.n(C),O=k.a.create({baseURL:"https://qnhd.twt.edu.cn/api/v1/f",withCredentials:!1,timeout:5e3});function x(e){return e.method=e.method||"get","get"===e.method.toLowerCase()&&(e.params=e.data),O(e)}O.interceptors.request.use((function(e){return T||"get"!==e.method&&"post"!==e.method||(e.params=Object(M["a"])(Object(M["a"])({},e.params),{},{token:y.state.token.length?y.state.token:_.app._route.query.token})),e}),(function(e){console.log(e)})),O.interceptors.response.use((function(e){var t=e.data;return 200===t.code?t:20001===t.code?(T=!0,t):(console.log(t),Promise.reject("网络请求异常，请稍后重试"))}),(function(e){console.log(e)})),["get","post","put","delete","patch"].forEach((function(e){x[e]=function(t,s,o){return x(Object(M["a"])({url:t,method:e,data:s},o))}}));var S=x,D=s("b2d8"),F=s.n(D);s("64e1");i["default"].use(F.a),i["default"].use(n.a.directive),i["default"].config.productionTip=!1,i["default"].prototype.$request=S,i["default"].prototype.$loading=n.a.service,new i["default"]({router:_,store:y,render:function(e){return e(p)}}).$mount("#app")},"87cf":function(e,t,s){"use strict";s("0d65")},a101:function(e,t,s){e.exports=s.p+"img/fold.b7bb7a01.svg"},b0a0:function(e,t,s){"use strict";s("452c")},f51c:function(e,t,s){e.exports=s.p+"img/more.0a1831bc.svg"}});
//# sourceMappingURL=app.a0c47994.js.map